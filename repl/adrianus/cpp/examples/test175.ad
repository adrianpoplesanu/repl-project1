class AsyncSimpleResponseServer {

    port = null
    server = null
    message = ""
    logger = AdLogger("AD", "AsyncSimpleResponseServer")
    httpParser = AdHTTPParser()

    def constructor(_port, _message) {
        logger.info('instantiating server...')
        port = _port
        message = _message
        server = ServerSocket(port)
    }

    def process(client) {
        //println('handling request')
        logger.info('handling request')
        //println(client)

        request_message = client.readHTTP()
        //println(request_message)
        logger.info(request_message)
        sleep(5000)

        client.send("HTTP/1.1 200 OK\r\nServer: AdServer\r\nContent-Type: text/html\r\nContent-Length: " + len(message) + "\r\nConnection: close\r\n\r\n" + message)
    }

    def start() {
        logger.info('server stated!')
        while(true) {
            server.accept()
            //println(server.client)
            logger.info(str(server.client))
            th1 = __thread("thread 1")

            th1.callback(this.process, server.client)
            th1.runAsync()
            //process(server.client)
        }
    }
}

asyncSimpleResponseServer = AsyncSimpleResponseServer(5003, '<html><title>AsyncSimpleResponseServer</title><body style="background-color: black"><font color="grey"><h1>Bebe Dex</h1>ham ham ham again</font></body></html>')
asyncSimpleResponseServer.start()

/*
GET request

curl localhost:5003
*/

/*
POST request

curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"username":"xyz","password":"xyz"}' \
  http://localhost:5003/api/login
*/
